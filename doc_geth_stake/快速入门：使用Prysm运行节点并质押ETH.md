# 快速入门：使用Prysm运行节点并质押ETH
## 配置
- Operating system : Windows
- Network : Goerli-Prater
- Execution client : Geth
- EN-BN connection : IPC

# 介绍
Prysm是以太坊权益证明共识规范的一个实现。在这个快速入门中，您将使用Prysm来运行一个以太坊节点，并可选择运行一个验证器。这将让您使用自己管理的硬件质押32个ETH。

这是一个面向初学者的指南。我们期望您熟悉命令行，但除此之外，本指南不假设您具备任何技术技能或先前知识。

在一个高层次上，我们将按照以下步骤进行：

1. 使用执行层客户端配置执行节点。
2. 使用Prysm（一个共识层客户端）配置信标节点。
3. 使用Prysm配置验证器并质押ETH（可选）。

## 步骤1：审查先决条件和最佳实践
| Node type	 | Benefits	                                                                                                                                                                                           |Requirements|
|------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---|
| 执行层 + 信标层  | - 有助于保障以太坊生态系统的安全性。<br>- 让您直接访问以太坊网络，无需依赖第三方服务的信任。<br>- 让您在合并后运行验证器。|- 软件要求：执行客户端（execution client）,信标节点客户端（beacon node client）（下面提供了客户端的安装说明）,curl<br> - 操作系统要求：64位Linux,Mac OS X 10.14+,Windows 10+ 64位<br> - CPU要求：4个以上的核心，主频2.8GHz以上<br> - 内存要求：16GB以上的RAM<br> - 存储要求：至少2TB的可用空间的SSD<br> - 网络要求：宽带连接，最低8 MBit/sec的带宽|
| 验证器层	 |让您可以质押ETH，提议和验证区块，获得权益奖励和交易手续费小费。| 除了之前提到的内容外，还需要以下内容：<br> - 软件要求：验证器客户端（validator client）,基于浏览器的加密钱包（下面提供了钱包的安装说明）<br> - 硬件要求：（推荐）一台全新的机器，从未连接过互联网，用于安全地生成助记词和密钥对<br> - 资产要求：32个ETH（主网）,32个测试网络ETH（测试网）|

### 最佳实践：
1. 如果您作为验证器质押ETH，请先在测试网络上尝试此指南，然后再尝试在主网上进行。
2. 保持简单。本指南假设所有客户端软件都在一台机器上运行。
3. 查看您使用的网络（如Goerli-Prater、主网）的最新警报和建议。
4. 查阅我们发布的所有安全最佳实践。
5. 加入社区 - 加入我们的邮件列表、Prysm Discord服务器、r/ethstaker（Reddit社区）和EthStaker Discord服务器，获取更新和支持。

## 步骤2: 安装 Prysm
在您的SSD上创建一个名为ethereum的文件夹，然后在其中创建两个子文件夹：consensus和execution。

进入您的consensus目录并运行以下命令：

    mkdir prysm && cd prysm
    curl https://raw.githubusercontent.com/prysmaticlabs/prysm/master/prysm.bat --output prysm.bat
    reg add HKCU\Console /v VirtualTerminalLevel /t REG_DWORD /d 1

这将下载Prysm客户端并更新您的注册表以启用详细日志记录。

## 步骤3：运行一个执行客户端。
在这一步中，您将安装一个执行层客户端，供Prysm的信标节点连接。

从Geth下载页面下载并运行适用于您操作系统的最新64位稳定版本的Geth安装程序。

进入您的执行目录，并运行以下命令启动执行节点：

    geth --goerli --http --http.api eth,net,engine,admin 

请参阅Geth的命令行选项以获取参数定义。

同步可能需要很长时间 - 从几小时到几天不等。您可以在执行节点同步的同时继续进行下一步。

恭喜！您现在正在运行以太坊执行层中的执行节点。

## 步骤4：使用Prysm运行信标节点。
在这一步中，您将使用Prysm运行信标节点。

从Github下载Prater的创世状态文件到您的consensus/prysm目录中。然后使用以下命令启动一个连接到本地执行节点的信标节点：

> --http-web3provider已被弃用，并已被--execution-endpoint取代，但是在Windows上，IPC目前仅通过--http-web3provider工作。这个问题将在我们的下一个版本中修复。在此期间，您可以安全地忽略任何与“deprecated flag”相关的警告。

    prysm.bat beacon-chain --http-web3provider=//./pipe/<your.ipc> --prater --genesis-state=genesis.ssz --suggested-fee-recipient=0x01234567722E6b0000012BFEBf6177F1D2e9758D9

如果您正在运行一个验证器，指定一个建议的手续费接收地址将允许您获得以前的矿工交易手续费小费。有关此功能的更多信息，请参阅如何配置手续费接收方。

您的信标节点现在将开始同步。这通常需要几天时间，但根据您的网络和硬件规格，可能需要更长的时间。

恭喜！您现在正在运行一个完整的、准备好合并的以太坊节点。要检查节点的状态，请访问“检查节点和验证器的状态”。

## 步骤5：使用Prysm运行验证器。
接下来，我们将使用以太坊Staking Deposit CLI创建您的验证器密钥。

从Staking Deposit CLI Releases页面下载最新稳定版本的deposit CLI。

运行以下命令来创建您的助记词（一个唯一且高度敏感的24个单词短语）和密钥：

    deposit.exe new-mnemonic --num_validators=1 --mnemonic_language=english --chain=prater

请按照CLI提示生成您的密钥。这将给您以下文件：
1. 一个新的助记词种子短语。这是非常敏感的信息，不应该暴露给其他人或网络硬件。
2. 一个validator_keys文件夹。该文件夹包含两个文件：
   1. deposit_data-*.json - 包含您将稍后上传到以太坊启动器的存款数据。
   2.  keystore-m_*.json - 包含您的公钥和加密的私钥。

将validator_keys文件夹复制到您的主要机器的consensus文件夹中。运行以下命令导入您的密钥库，将<YOUR_FOLDER_PATH>替换为consensus/validator_keys文件夹的完整路径：

    prysm.bat validator accounts import --keys-dir=<YOUR_FOLDER_PATH> --prater

您将被要求两次指定钱包目录。对于这两个提示，请提供consensus文件夹的路径。当您的账户成功导入到Prysm后，您应该会看到“成功导入1个账户，通过运行accounts list查看所有账户”。

接下来，前往Goerli-Prater Launchpad的存款数据上传页面，上传您的deposit_data-*.json文件。您将被要求连接您的钱包。

如果您需要GöETH，请前往以下其中一个Discord服务器：
- r/EthStaker Discord
- Prysm Discord server

有人应该能够为您提供所需的 GöETH。然后，您可以通过Launchpad页面将32个GöETH存入Prater测试网络的存款合约中。在整个过程中要非常小心，永远不要将真正的ETH发送到测试网络的存款合约中。最后，运行以下命令以启动您的验证器，将<YOUR_FOLDER_PATH>替换为您共识文件夹的完整路径：

      prysm.bat validator --wallet-dir=<YOUR_FOLDER_PATH> --prater

> 恭喜！您现在已经运行了一个完整的以太坊节点和一个验证器。

您的验证器要完全激活可能需要很长时间（从几天到几个月不等）。要了解有关验证器激活过程的更多信息，请参阅存款过程。请参阅检查节点和验证器状态以获取详细的状态监控指南。

您可以保持执行客户端、信标节点和验证器客户端终端窗口保持打开和运行。一旦您的验证器被激活，它将自动开始提议和验证区块。

## 常见问题解答：
#### Geth从"State heal in progress"过渡到完全同步需要多长时间？
如果您的磁盘I/O相对较慢，通常需要几个小时。如果它在这个状态下停留超过一天，可能是因为您的磁盘无法以与链头推进速度相同的速度写入数据。解决这个问题的最直接方法是使用SSD固态硬盘。

#### 为什么您建议将所有内容都放在一台机器上？
将所有客户端软件放在一台机器上可以保持简单，与我们的安全最佳实践保持一致。

#### 我可以在Mac M1 ARM芯片上使用Prysm吗？
可以。请执行以下操作之一，以确保Prysm可以在您的M1上运行：
1. 设置环境变量：export PRYSM_ALLOW_UNVERIFIED_BINARIES=1。请参阅Apple的终端用户指南：使用环境变量以获取详细说明。
2. 通过Rosetta运行Prysm。请参阅我们的已知问题以获取更多信息。

#### 如果我使用IPC而不是HTTP，是否需要配置JWT？
不需要。

#### 我需要配置防火墙吗？
我们建议关闭TCP端口8545对外网，并保持TCP和UDP端口30303打开以支持其他执行节点。

#### 我可以在执行层和共识层之间混合使用网络吗？
不可以。请参阅节点和网络以获取更多信息。

#### 我能用少于32个ETH进行质押吗？
可以！池化质押可以让您用少于32个ETH进行质押。

#### 如果我不能使用自己的硬件运行节点该怎么办？
您可以将硬件管理委托给提供质押作为服务的供应商。

#### 我可以在Prysm中使用轻节点吗，还是需要运行完整的执行节点？
不行-此时需要运行完整节点。

#### 我可以使用通过USB连接的外部SSD吗？
可以，但是您的USB连接可能存在故障风险。如果这样做，请避免通过USB集线器将SSD连接到计算机-而是直接连接它。

#### 我可以使用轻客户端作为我的本地执行客户端，这样我就不需要下载那么多数据了吗？
不行，需要一个完整的执行节点。

#### 为什么我需要运行自己的执行客户端？
合并引入了一个新的引擎API，允许共识层客户端与执行层客户端进行通信。Teku文档中有一个很好的解释器：合并。

#### 如果我的执行客户端停止工作会发生什么？我会受到处罚吗？
会的。停机惩罚很小，但我们建议尽可能为您的执行节点、信标节点和验证器配置正常运行时间和停机时间的警报。

#### 我的信标节点同步时间很长。有没有办法可以加快速度？
有的-您可以使用检查点同步，从检查点开始同步信标节点，而不是从创世块开始。这实际上是一种更安全的运行信标节点的方式。

#### 我的提议不起作用，但我的证明有效。出了什么问题？
通常这表明您的验证器无法与信标节点通信，或者您的信标节点无法连接到执行节点。

#### 我的验证器要等多久才能被选中提议一个新的区块？
在撰写本文时，大致估计约为一周。每12秒提议一个新的区块，您的验证器有1/[活跃验证器的总数]的机会被选中，所以这个持续时间可能因验证器而异。

> 要进行以太坊池化质押，您可以按照以下步骤操作：  
> 1. 寻找可信的池化质押平台：首先，您需要找到一个可信赖的以太坊池化质押平台。确保平台有良好的声誉和安全记录，并提供透明的运营和收益分配机制。您可以通过在线搜索、社区推荐或咨询其他以太坊持有者来找到合适的平台。
> 
> 2. 注册和验证身份：在选择了一个平台后，您需要在平台上注册一个账户，并完成身份验证的过程。通常，这涉及提供一些个人信息和KYC（了解您的客户）文件，以确保您的身份和合规性。
> 
> 3. 存入以太坊代币：一旦您的账户已注册并通过验证，您可以将自己的以太坊代币存入平台的质押池中。通常，平台会提供一个简单的界面，您可以选择要存入的代币数量和质押期限。确保您了解平台的质押规则、利率和风险提示。
> 
> 4. 参与质押：一旦您存入了以太坊代币，平台将开始使用这些代币参与以太坊网络的验证和维护工作。这可能涉及到将代币质押给验证器节点，或者将代币委托给质押池的操作员。
> 
> 5. 获得收益：作为质押者，您将有权获得相应的收益。这些收益可能来自于区块奖励、手续费分配或其他激励机制。平台会根据您贡献的质押资金比例来计算和分配收益。确保您了解平台的收益分配机制和结算周期。
> 
> 6. 监控和管理：在进行池化质押后，您可以通过平台提供的界面或工具来监控和管理您的质押资金和收益。您可以查看质押的状态、收益历史、提现选项等。确保您定期检查和管理您的质押资金，以便及时调整和优化策略。
> 
> 请注意，以上步骤仅供参考，实际操作可能因平台的不同而有所不同。在进行任何质押操作之前，请务必仔细阅读平台的相关规则、条款和风险提示，并了解质押的风险和收益潜力。

> 池化质押平台有哪些
> 
> [Rocket Pool](https://www.rocketpool.net/): Rocket Pool是一个去中心化的以太坊池化质押平台，它允许用户将他们的以太坊存入质押池中，共同参与以太坊2.0的验证过程，并享受质押奖励。
> 
> [Lido Finance](https://www.lido.fi/): Lido Finance是一个去中心化的质押解决方案，它允许用户将他们的以太坊代币质押并通过验证节点参与以太坊2.0网络的验证过程。Lido Finance还提供了代币化的质押凭证（stETH），使用户可以在质押期间继续交易和流动性。
> 
> [StakeWise](https://stakewise.io/): StakeWise是一个以太坊池化质押平台，它提供了一种简单而安全的方式让用户将他们的以太坊代币质押，并参与以太坊2.0的验证过程。StakeWise还为质押者提供了流动性凭证（stETH），可以在质押期间进行交易和使用。
> 
> [Ankr](https://www.ankr.com/): Ankr是一个去中心化的质押平台，它允许用户将他们的以太坊代币质押并通过验证节点参与以太坊2.0网络的验证过程。Ankr还提供了一种简单的方式来管理和监控质押资金，并提供了实时的收益计算和分配。
> 
> 这只是一小部分以太坊池化质押平台的例子，还有其他平台也提供类似的服务。在选择平台时，请务必仔细研究和比较不同平台的特点、费用结构、安全性和声誉，并确保平台符合您的需求和风险承受能力。




