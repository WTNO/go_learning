go-ethereum所有的数据存储在levelDB这个Google开源的KeyValue文件数据库中，整个区块链的所有数据都存储在一个levelDB的数据库中，levelDB支持按照文件大小切分文件的功能，所以我们看到的区块链的数据都是一个一个小文件，其实这些小文件都是同一个levelDB实例。这里简单的看下levelDB的go封装代码。

levelDB官方网站介绍的特点：
- key和value都是任意长度的字节数组；
- entry（即一条K-V记录）默认是按照key的字典顺序存储的，当然开发者也可以重载这个排序函数；
- 提供的基本操作接口：Put()、Delete()、Get()、Batch()；
- 支持批量操作以原子操作进行；
- 可以创建数据全景的snapshot(快照)，并允许在快照中查找数据；
- 可以通过前向（或后向）迭代器遍历数据（迭代器会隐含的创建一个snapshot）；
- 自动使用Snappy压缩数据；
- 可移植性；

限制：
- 非关系型数据模型（NoSQL），不支持sql语句，也不支持索引；
- 一次只允许一个进程访问一个特定的数据库；
- 没有内置的C/S架构，但开发者可以使用LevelDB库自己封装一个server；

源码所在的目录在ethereum/ethdb目录。代码比较简单， 分为下面三个文件
- `database.go`： levelDB的封装代码
- `memory_database.go`： 供测试用的基于内存的数据库，不会持久化为文件，仅供测试
- ~~`interface.go`~~： 定义了数据库的接口
- `database_test.go`： 测试案例

### database.go
基本上定义了KeyValue数据库的基本操作， Put， Get， Has， Delete等基本操作，levelDB是不支持SQL的，基本可以理解为数据结构里面的Map。
```go
// Reader contains the methods required to read data from both key-value as well as
// immutable ancient data.
type Reader interface {
    KeyValueReader
    AncientReader
}

// Writer contains the methods required to write data to both key-value as well as
// immutable ancient data.
type Writer interface {
    KeyValueWriter
    AncientWriter
}

// KeyValueReader wraps the Has and Get method of a backing data store.
type KeyValueReader interface {
    // Has retrieves if a key is present in the key-value data store.
    Has(key []byte) (bool, error)
    
    // Get retrieves the given key if it's present in the key-value data store.
    Get(key []byte) ([]byte, error)
}

// KeyValueWriter wraps the Put method of a backing data store.
type KeyValueWriter interface {
    // Put inserts the given value into the key-value data store.
    Put(key []byte, value []byte) error
    
    // Delete removes the key from the key-value data store.
    Delete(key []byte) error
}

// Database contains all the methods required by the high level database to not
// only access the key-value data store but also the chain freezer.
type Database interface {
    Reader
    Writer
    Batcher
    Iteratee
    Stater
    Compacter
    Snapshotter
    io.Closer
}
```
















































